# 产品需求文档（PRD）

## 1. 产品信息

**产品名称**：敲敲木鱼

**产品定位**：通过模拟木鱼敲击、功德数积累，帮助用户修行、放松，同时支持功德兑换、排行榜、社交分享。

**目标用户**：
- 主要用户：佛学爱好者、修行者
- 次要用户：寻求减压放松的人群、游戏化体验爱好者

**核心价值**：数字化功德记录 + 可视化互动体验，让修行行为更具沉浸感和趣味性。

## 1.1 用户角色和使用场景

### 用户角色
1. **修行者**: 定期敲击木鱼进行修行，关注功德积累
2. **休闲用户**: 偶尔使用来放松减压，关注音效和视觉体验
3. **社交用户**: 关注排行榜竞争，乐于分享成就

### 使用场景
1. **日常修行**: 早晚定时敲击木鱼，积累功德
2. **压力释放**: 工作间隙使用自动模式放松
3. **社交互动**: 查看排行榜，与朋友比较功德数
4. **成就收集**: 解锁皮肤、音效等虚拟物品

## 2. 核心功能模块

### 2.1 敲木鱼（核心功能）

**功能描述**：
- 点击木鱼按钮模拟敲击，播放音效并显示动画反馈
- 每次敲击积累功德值
- 支持手动和自动两种敲击模式

**详细需求**：

**手动敲击**：
- 点击响应：≤100ms
- 单次敲击获得1功德值
- 连击加成：连续敲击时可获得额外功德加成
- 防刷机制：限制单位时间内最大敲击次数（如每秒最多10次）

**自动敲击**：
- 时长选项：10秒、30秒、1分钟、5分钟、10分钟
- 自动敲击频率：每秒1-2次
- 可暂停/恢复自动敲击
- 自动模式下功德获取效率为手动模式的80%

**界面元素**：
- 木鱼按钮（支持点击动画）
- 实时功德计数器
- 功德增加动效提示
- 自动模式控制面板
- 敲击次数统计

### 2.2 功德系统

**功德值规则**：
- 基础敲击：+1功德值
- 连击加成：连续敲击5次内，每次额外+0.1功德值
- 日常任务额外奖励：首次登录+10、连续敲击100次+20等

**功德等级体系**：
- 初级修行者：0-1万功德
- 虔诚信徒：1万-5万功德  
- 资深修行者：5万-15万功德
- 得道高僧：15万-50万功德
- 佛陀境界：50万+功德

**功德币经济系统**：
- 兑换比例：1000功德 = 1功德币
- 每日兑换限额：最多兑换100功德币
- 功德币用途：购买皮肤、音效、背景、道具

### 2.3 排行榜

**榜单类型**：
- 日榜：当日功德累计排名（每日0点重置）
- 周榜：本周功德累计排名（每周一0点重置）
- 总榜：历史功德总计排名

**排名展示**：
- 显示前100名用户
- 信息包含：排名、头像、昵称、功德值、等级标识
- 用户自己的排名始终显示（即使不在前100）

**奖励机制**：
- 日榜前10名：获得特殊称号24小时
- 周榜前3名：获得限定皮肤
- 月榜第1名：获得专属头像框

### 2.4 捐赠功能

**捐赠对象**：
- 虚拟庙宇建设项目
- 放生功德池
- 助学善缘基金
- 环保护生项目

**捐赠规则**：
- 最低捐赠：10功德币
- 捐赠记录永久保存
- 单笔捐赠超过100功德币可留言祈愿

**善缘榜**：
- 展示历史捐赠总额排名
- 显示最近捐赠记录
- 捐赠用户可获得"善缘使者"等特殊标识

### 2.5 个人中心

**用户信息**：
- 基础信息：头像、昵称、用户ID、注册时间
- 修行数据：累计功德值、累计敲击次数、修行天数
- 当前等级和进度条

**道具系统**：
- **木鱼皮肤**：经典木鱼、黄金木鱼、莲花木鱼等
- **敲击音效**：传统木鱼声、禅钟声、寺庙环境音
- **背景主题**：寺庙、竹林、莲池、雪山等

**成就系统**：
- 敲击成就：累计敲击1000次、1万次、10万次
- 连续成就：连续登录7天、30天
- 功德成就：累计功德10万、50万、100万
- 社交成就：捐赠达到一定金额、排行榜进入前10等

**设置功能**：
- 音效开关和音量调节
- 震动反馈开关
- 通知设置（每日提醒修行）
- 隐私设置（排行榜显示选项）
- 账号管理（修改昵称、密码重置）

## 3. 用户流程设计

### 3.1 核心用户流程
1. **注册/登录** → 用户进入首页
2. **敲击木鱼** → 功德值实时增加 → 等级提升提示
3. **功德兑换** → 将功德转换为功德币 → 购买道具
4. **查看排行榜** → 了解自己排名 → 激励继续修行
5. **个人中心** → 查看成就和道具 → 自定义体验

### 3.2 关键交互流程
- **新用户引导**：注册后自动获得10功德值，引导完成第一次敲击
- **等级提升**：功德达到等级阈值时弹窗庆祝，展示新等级特权
- **每日首次登录**：展示昨日修行总结，获得登录奖励

## 4. 数据库设计需求

### 4.1 用户相关表
**users (用户表)**：
- id (主键，雪花算法)、username (用户名)、password (密码hash)
- avatar_url (头像)、nickname (昵称)、email (邮箱)
- register_time、last_login_time、status (账号状态)

**user_stats (用户统计表)**：
- id (主键，雪花算法)、user_id (关联users.id)、total_merit (总功德)、merit_coins (功德币)
- total_knocks (总敲击次数)、consecutive_days (连续登录天数)
- current_level (当前等级)、daily_merit (当日功德)
- weekly_merit (本周功德)、last_knock_time (最后敲击时间)

### 4.2 功能相关表
**merit_records (功德记录表)**：
- id (主键，雪花算法)、user_id (关联users.id)、merit_gained (获得功德)
- knock_type (敲击类型：manual/auto)、source (来源：knock/task/login)
- create_time、session_id (会话ID，用于统计连击)

**exchange_records (兑换记录表)**：
- id (主键，雪花算法)、user_id (关联users.id)、merit_used (使用功德)
- merit_coins_gained (获得功德币)、exchange_time

**donations (捐赠记录表)**：
- id (主键，雪花算法)、user_id (关联users.id)、project_id (捐赠项目)
- merit_coins_donated (捐赠功德币)、message (祈愿留言)
- donation_time、is_anonymous (是否匿名)

### 4.3 系统配置表
**merit_levels (功德等级配置表)**：
- id (主键，雪花算法)、level_name (等级名称)、min_merit (最低功德)
- max_merit (最高功德)、level_benefits (等级特权)

**items (道具表)**：
- id (主键，雪花算法)、item_name (道具名称)、item_type (类型：skin/sound/background)
- price (功德币价格)、description (描述)、is_active (是否上架)

**user_items (用户道具关联表)**：
- id (主键，雪花算法)、user_id (关联users.id)、item_id (关联items.id)、purchase_time、is_equipped (是否装备)

### 4.4 排行榜相关表
**rankings (排行榜快照表)**：
- id (主键，雪花算法)、user_id (关联users.id)、rank_type (日/周/总榜)
- merit_value (功德值)、ranking_position (排名)、snapshot_date

## 5. 技术需求

### 5.1 性能要求
- **响应时间**：敲击响应 ≤ 100ms，页面加载 ≤ 2s
- **并发支持**：支持1000+用户同时在线
- **数据一致性**：功德数据必须严格一致，防止刷数据

### 5.2 接口规范

#### 用户认证接口
```
POST /api/auth/register    # 用户注册
POST /api/auth/login      # 用户登录
POST /api/auth/logout     # 用户登出
```

#### 敲击功能接口
```
POST /api/knock/manual    # 手动敲击
POST /api/knock/auto/start # 开始自动敲击
POST /api/knock/auto/stop  # 停止自动敲击
GET  /api/knock/stats     # 获取敲击统计
```

#### 功德系统接口
```
GET  /api/merit/balance   # 获取功德和功德币余额
POST /api/merit/exchange  # 功德兑换功德币
GET  /api/merit/history   # 功德获取历史
```

#### 排行榜接口
```
GET  /api/rankings/daily   # 日榜
GET  /api/rankings/weekly  # 周榜
GET  /api/rankings/total   # 总榜
GET  /api/rankings/user/{userId} # 用户排名
```

#### 商城和道具接口
```
GET  /api/shop/items      # 获取道具列表
POST /api/shop/purchase   # 购买道具
GET  /api/user/items      # 用户道具列表
POST /api/user/equip      # 装备道具
```

### 5.3 安全要求
- 所有敏感操作需要用户认证
- 功德数据变更需要日志记录
- 防止恶意刷功德的安全策略
- 用户敏感信息加密存储

## 6. 业务规则详细说明

### 6.1 功德计算规则
- **基础敲击**：每次+1功德值
- **连击加成**：连续5次内每次额外+0.1功德值
- **时间限制**：单用户每秒最多记录10次有效敲击
- **自动模式**：按设定频率自动累计，效率为手动80%

### 6.2 防刷策略
- IP限制：单IP每分钟最多产生1000功德值
- 行为检测：异常高频敲击触发验证码
- 数据校验：服务端验证每次功德变化的合理性
- 账号封禁：检测到作弊行为自动封禁24小时

### 6.3 等级提升机制
- 等级计算基于总功德值
- 等级提升即时生效
- 跨等级时触发特殊奖励（额外功德币）
- 等级降级：不支持等级降级

## 7. 非功能性需求

### 7.1 用户体验要求
- **界面友好**：简洁易懂，符合佛学文化美学
- **音效质量**：高品质音频，支持用户自定义音量
- **动画流畅**：60fps流畅动画，木鱼敲击有真实感
- **加载优化**：首屏加载≤2秒，后续操作≤1秒响应

### 7.2 兼容性要求
- **浏览器支持**：Chrome 80+、Firefox 75+、Safari 13+
- **移动端适配**：响应式设计，支持iOS/Android主流浏览器
- **设备兼容**：支持触屏和鼠标操作

### 7.3 可扩展性考虑
- 支持多语言扩展（中文、英文、日文等）
- 支持多种文化主题（佛教、道教、禅宗等）
- 预留第三方集成接口（社交媒体分享）

## 8. 运营策略

### 8.1 用户增长
- **新手礼包**：注册即获得100功德值和基础道具
- **分享机制**：分享成就到社交媒体获得额外功德
- **邀请奖励**：邀请好友注册双方各获得500功德值

### 8.2 用户留存
- **每日任务**：每日登录、敲击100次等日常任务
- **节日活动**：佛诞节、观音诞等节日双倍功德活动
- **限时道具**：季节性限定皮肤和音效

### 8.3 商业化考虑
- **功德币充值**：支持人民币直接购买功德币
- **会员系统**：月卡/年卡用户享受功德获取加成
- **广告变现**：观看视频广告获得额外功德奖励

## 9. 开发优先级

### 第一期（MVP）：
1. 用户注册登录系统
2. 基础敲击功能和功德累计
3. 简单的个人中心和等级系统
4. 基础排行榜功能

### 第二期：
1. 功德币兑换系统
2. 道具商城和装备系统
3. 自动敲击模式
4. 成就系统

### 第三期：
1. 捐赠功能和善缘榜
2. 社交分享功能
3. 高级排行榜和奖励
4. 运营活动系统

## 10. 风险和约束

### 10.1 技术风险
- **高并发处理**：敲击行为可能产生大量并发请求
- **数据一致性**：多用户同时操作时的数据同步问题
- **安全防护**：防止恶意刷数据和攻击

### 10.2 业务风险
- **用户流失**：单一玩法可能导致用户快速厌倦
- **内容审核**：用户生成内容（昵称、祈愿留言）需要审核
- **文化敏感**：需要注意宗教文化的准确性和敏感性

### 10.3 法律合规
- 用户数据隐私保护
- 虚拟物品交易合规性
- 宗教内容合规性审查