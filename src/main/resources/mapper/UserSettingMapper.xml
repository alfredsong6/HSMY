<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hsmy.mapper.UserSettingMapper">
    
    <!-- 基础结果映射 -->
    <resultMap id="BaseResultMap" type="com.hsmy.entity.UserSetting">
        <id column="id" property="id"/>
        <result column="user_id" property="userId"/>
        <result column="sound_enabled" property="soundEnabled"/>
        <result column="sound_volume" property="soundVolume"/>
        <result column="vibration_enabled" property="vibrationEnabled"/>
        <result column="daily_reminder" property="dailyReminder"/>
        <result column="reminder_time" property="reminderTime"/>
        <result column="privacy_mode" property="privacyMode"/>
        <result column="auto_knock_speed" property="autoKnockSpeed"/>
        <result column="theme_id" property="themeId"/>
        <result column="skin_id" property="skinId"/>
        <result column="sound_id" property="soundId"/>
        <result column="bullet_screen" property="bulletScreen"/>
        <result column="create_by" property="createBy"/>
        <result column="create_time" property="createTime"/>
        <result column="update_by" property="updateBy"/>
        <result column="update_time" property="updateTime"/>
        <result column="is_deleted" property="isDeleted"/>
    </resultMap>
    
    <!-- 基础字段列表 -->
    <sql id="Base_Column_List">
        id, user_id, sound_enabled, sound_volume, vibration_enabled, daily_reminder,
        reminder_time, privacy_mode, auto_knock_speed, theme_id, skin_id, sound_id, bullet_screen,
        create_by, create_time, update_by, update_time, is_deleted
    </sql>
    
    <!-- 根据用户ID查询用户设置 -->
    <select id="selectByUserId" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM t_user_setting
        WHERE user_id = #{userId}
        AND is_deleted = 0
        LIMIT 1
    </select>
    
    <!-- 根据用户ID更新设置 -->
    <update id="updateByUserId">
        UPDATE t_user_setting
        <set>
            <if test="soundEnabled != null">sound_enabled = #{soundEnabled},</if>
            <if test="soundVolume != null">sound_volume = #{soundVolume},</if>
            <if test="vibrationEnabled != null">vibration_enabled = #{vibrationEnabled},</if>
            <if test="dailyReminder != null">daily_reminder = #{dailyReminder},</if>
            <if test="reminderTime != null">reminder_time = #{reminderTime},</if>
            <if test="privacyMode != null">privacy_mode = #{privacyMode},</if>
            <if test="autoKnockSpeed != null">auto_knock_speed = #{autoKnockSpeed},</if>
            <if test="themeId != null">theme_id = #{themeId},</if>
            <if test="skinId != null">skin_id = #{skinId},</if>
            <if test="soundId != null">sound_id = #{soundId},</if>
            <if test="bulletScreen != null">bullet_screen = #{bulletScreen},</if>
            update_time = NOW(),
            <if test="updateBy != null">update_by = #{updateBy}</if>
        </set>
        WHERE user_id = #{userId}
        AND is_deleted = 0
    </update>

    <!-- 更新弹幕设置 -->
    <update id="updateBulletScreen">
        UPDATE t_user_setting
        SET bullet_screen = #{bulletScreen},
            update_time = NOW()
        WHERE user_id = #{userId}
        AND is_deleted = 0
    </update>
    
</mapper>
