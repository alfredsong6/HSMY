<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hsmy.mapper.DonationProjectMapper">
    
    <!-- 查询进行中的项目 -->
    <select id="selectActiveProjects" resultType="com.hsmy.entity.DonationProject">
        SELECT * FROM t_donation_project
        WHERE status = 1
        AND is_deleted = 0
        ORDER BY create_time DESC
    </select>
    
    <!-- 更新项目募集金额 -->
    <update id="updateCurrentAmount">
        UPDATE t_donation_project
        SET current_amount = current_amount + #{amount},
            update_time = NOW()
        WHERE id = #{projectId}
        AND is_deleted = 0
    </update>
    
    <!-- 增加捐赠人数 -->
    <update id="incrementDonorCount">
        UPDATE t_donation_project
        SET donor_count = donor_count + 1,
            update_time = NOW()
        WHERE id = #{projectId}
        AND is_deleted = 0
    </update>
    
</mapper>